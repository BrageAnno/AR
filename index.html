<!DOCTYPE html>
<html>
<head>
  <title>Inside Sphere Viewer</title>
  <script src="aframe.min.js"></script> <!-- Include A-Frame library -->
</head>
<body>
  <a-scene device-orientation-permission-ui>
    <!-- Import your existing .glb file -->
    <a-entity id="sphere" gltf-model="./360_HDRI_Test.glb" position="0 1.6 0" rotation="0 0 0"></a-entity>

    <!-- Place the camera inside the sphere -->
    <a-entity camera position="0 1.6 0"></a-entity>

    <!-- Place the arrow in the bottom right corner of the screen -->
    <a-entity
      id="arrow"
      position="0.9 -1.6 -1"
      geometry="primitive: cone; height: 0.1; radiusBottom: 0.05"
      material="color: red"
      rotation="-90 0 0"
    ></a-entity>
  </a-scene>

  <script>
    // Function to handle device orientation events
    function handleOrientation(event) {
      var alpha = event.alpha; // Compass direction in degrees

      // Get the sphere entity
      var sphere = document.getElementById('sphere');

      // Get the initial compass reading from local storage
      var initialCompassReading = parseFloat(localStorage.getItem('initialCompassReading'));

      // If initial compass reading is not set, set it
      if (isNaN(initialCompassReading)) {
        initialCompassReading = alpha;
        localStorage.setItem('initialCompassReading', initialCompassReading);
      }

      // Calculate the rotation difference between current compass reading and initial reading
      var rotationDifference = initialCompassReading - alpha;

      // Apply rotation difference to the sphere's y-axis to keep it oriented with the compass
      var rotation = sphere.getAttribute('rotation');
      rotation.y = rotationDifference; 
      sphere.setAttribute('rotation', rotation);
    }

    // Listen for device orientation events
    window.addEventListener('deviceorientation', handleOrientation);
  </script>
</body>
</html>